{% extends "base.html" %}
{% block page_content %}
<!-- Navegaci√≥n -->
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container">
        <ul class="navbar-nav me-auto">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Celulares</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('dispositivos') }}">Dispositivos</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('caja') }}">Caja</a></li>
            <li class="nav-item"><a class="nav-link active" href="{{ url_for('configuracion_empresa') }}">‚öôÔ∏è Configuraci√≥n</a></li>
        </ul>
        <span class="navbar-text">Rol: {{ user.role }} | Usuario: {{ user.username }}</span>
    </div>
</nav>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">‚öôÔ∏è Configuraci√≥n de la Empresa</h4>
                    <small>Estos datos aparecer√°n en las facturas generadas</small>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('guardar_configuracion') }}" enctype="multipart/form-data">
                        <!-- Logo -->
                        <h5 class="border-bottom pb-2 mb-3">üñºÔ∏è Logo de la Empresa</h5>
                        
                        {% if config and config.logo_filename %}
                        <div class="mb-3 text-center">
                            <img src="{{ url_for('static', filename='uploads/' + config.logo_filename) }}" 
                                 alt="Logo actual" 
                                 style="max-width: 200px; max-height: 100px;"
                                 class="img-thumbnail">
                            <p class="text-muted small mt-2">Logo actual</p>
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Subir nuevo logo</label>
                            <input type="file" class="form-control" name="logo" accept="image/*">
                            <div class="form-text">Tama√±o recomendado: 200x80px. Formatos: PNG, JPG, JPEG, GIF. M√°x: 5MB</div>
                        </div>
                        
                        <!-- Datos principales -->
                        <h5 class="border-bottom pb-2 mb-3 mt-4">üè™ Datos del Negocio</h5>
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label fw-bold">Nombre del Negocio <span class="text-danger">*</span></label>
                                <input type="text" class="form-control form-control-lg" name="nombre" 
                                       value="{{ config.nombre if config else 'CellStore' }}" required placeholder="Ej: CellStore">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold">NIT <span class="text-danger">*</span></label>
                                <input type="text" class="form-control form-control-lg" name="nit" 
                                       value="{{ config.nit if config else '900.123.456-7' }}" required placeholder="Ej: 900.123.456-7">
                            </div>
                        </div>
                        
                        <!-- Contacto -->
                        <h5 class="border-bottom pb-2 mb-3 mt-4">üìû Contacto</h5>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Tel√©fono <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="telefono" 
                                       value="{{ config.telefono if config else '(601) 234-5678' }}" required placeholder="Ej: 300-123-4567">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="email" 
                                       value="{{ config.email if config else '' }}" placeholder="Opcional">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Instagram URL</label>
                            <input type="url" class="form-control" name="instagram_url" 
                                   value="{{ config.instagram_url if config else '' }}" placeholder="https://instagram.com/tuusuario">
                            <div class="form-text">Se usa para generar el c√≥digo QR en la factura</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Direcci√≥n</label>
                            <input type="text" class="form-control" name="direccion" 
                                   value="{{ config.direccion if config else '' }}" placeholder="Ej: Calle 123 # 45-67, Local 101">
                        </div>
                        
                        <!-- Vista previa -->
                        <div class="card bg-light mt-4">
                            <div class="card-header">
                                <strong>üëÅÔ∏è Vista Previa del Ticket</strong>
                            </div>
                            <div class="card-body text-center" style="font-family: monospace; font-size: 11px; max-width: 280px; margin: 0 auto; background: white; padding: 15px;">
                                {% if config and config.logo_filename %}
                                <img src="{{ url_for('static', filename='uploads/' + config.logo_filename) }}" 
                                     style="max-width: 150px; max-height: 60px; margin-bottom: 8px;">
                                {% endif %}
                                <div id="preview-nombre" class="fw-bold" style="font-size: 13px;">{{ config.nombre if config else 'CELLSTORE' }}</div>
                                <div id="preview-nit" style="font-size: 9px;">NIT: {{ config.nit if config else '900.123.456-7' }}</div>
                                <div id="preview-telefono" style="font-size: 9px;">Tel: {{ config.telefono if config else '(601) 234-5678' }}</div>
                                <div style="border-top: 1px dashed #999; margin: 10px 0;"></div>
                                <div class="fw-bold">FACTURA DE VENTA</div>
                                <div style="font-size: 9px;">No: 000001</div>
                                <div style="border-top: 1px dashed #999; margin: 10px 0;"></div>
                                <div class="text-muted small">Este es un ejemplo de c√≥mo<br>se ver√° su factura impresa</div>
                            </div>
                        </div>
                        
                        <!-- Botones -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê Volver</a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                üíæ Guardar Configuraci√≥n
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Actualizar vista previa en tiempo real
    document.querySelector('input[name="nombre"]').addEventListener('input', function() {
        document.getElementById('preview-nombre').textContent = this.value || 'CELLSTORE';
    });
    document.querySelector('input[name="nit"]').addEventListener('input', function() {
        document.getElementById('preview-nit').textContent = 'NIT: ' + (this.value || 'XXX.XXX.XXX-X');
    });
    document.querySelector('input[name="telefono"]').addEventListener('input', function() {
        document.getElementById('preview-telefono').textContent = 'Tel: ' + (this.value || '000-000-0000');
    });
    
    // Preview de imagen al seleccionar
    document.querySelector('input[name="logo"]').addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.querySelector('.card-body img');
                if (preview) {
                    preview.src = event.target.result;
                } else {
                    // Crear preview si no existe
                    const previewContainer = document.querySelector('.card-body .text-center');
                    if (previewContainer) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.maxWidth = '150px';
                        img.style.maxHeight = '60px';
                        img.style.marginBottom = '8px';
                        img.style.display = 'block';
                        img.style.marginLeft = 'auto';
                        img.style.marginRight = 'auto';
                        previewContainer.insertBefore(img, previewContainer.firstChild);
                    }
                }
            };
            reader.readAsDataURL(e.target.files[0]);
        }
    });
</script>
{% endblock %}
